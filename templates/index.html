<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Vis Network | Basic usage</title>

    <script
      type="text/javascript"
      src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"
    ></script>

    <style type="text/css">
      #mynetwork {
        width: 800px;
        height: 800px;
        border: 1px solid lightgray;
        background-color: #1e1e1e;
      }
    </style>
  </head>
  <body>

    <div id="mynetwork"></div>

    <button onclick="clear">clear</button>


    <script type="text/javascript">

      const nodes = new vis.DataSet([]);
      const edges = new vis.DataSet([]);

      // create a network
      var container = document.getElementById("mynetwork");

      var data = {
        nodes: nodes,
        edges: edges,
      };

      var options = {
        nodes: {
          shape: "box",
          shadow: true,
        },
        edges: {
          width: 2,
          shadow: true,
        },
        {{/* configure: {
          enabled: true,
          container: undefined,
          showButton: true
        }, */}}
        {{/* layout: {
          hierarchical: {
            enabled: true,
            levelSeparation: 400,
            direction: "LR",
            sortMethod: "directed",
          }
        }, */}}
      };
      const network = new vis.Network(container, data, options);
      
      fetch('/nodes')
        .then(res => res.json())
        .then(data => data.items)
        .then(pods => {
          pods.forEach(pod => {
            console.log(pod)
            const { metadata, spec } = pod
            const { name, namespace } = metadata
            
            //create ns node
            try{
              nodes.add({ id: namespace, label: namespace, shape: "circle",  group: namespace})
            }catch(e){
              console.log(e)
            }

            //create pod node
            nodes.add({ id: name, label: name, group: namespace})

            // add namespace to pod edges
            try{
              edges.add({ from: namespace, to: name})
            }catch(e){
              console.log(e)
            }

            spec.containers.forEach((container, i) => {
              const id = `${name}_${container.name}_${i}`
              nodes.add({
                id,
                label: `${container.name} \n ${container.image}`,
                group: namespace
              })

              edges.add({from: name, to: id})
            })
            
          })  
        })
      
      
    </script>

  </body>
</html>

